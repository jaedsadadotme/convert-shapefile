
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Quick Start - Leaflet</title>
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ==" crossorigin=""></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		.leaflet-container {
			height: 400px;
			width: 600px;
			max-width: 100%;
			max-height: 100%;
		}
	</style>
</head>
<body ng-app="postserviceApp" ng-controller="postserviceCtrl">
	<div style="padding: 1rem;">
		<!-- <form method="POST" enctype="multipart/form-data"> -->
			<div>
				shpfile: 
				<input type="file" name="shp" id="shp">
				dbf: 
				<input type="file" name="dbf" id="dpf">
			</div>
			<br>
			<div>
				<a href="javascript:void(0)" ng-click="postdata()">upload</a>
			</div>
		<!-- </form> -->
	</div>
<hr>
<div style="padding: 3rem;">
	<div id="map" style="width: 100%; height: 100vh;"></div>
</div>


<script>
	var app = angular.module('postserviceApp', []);
	app.controller('postserviceCtrl', function ($scope, $http) {
		$scope.postdata = function () {
			const shp = document.querySelector('[name=shp]').files;
			const dbf = document.querySelector('[name=dbf]').files;
			const formData = new FormData();
			formData.append('shp', shp[0]);
			formData.append('dbf', dbf[0]);
			// const xhr = new XMLHttpRequest();
			// xhr.open('POST', 'http://localhost:5000',true);
			// xhr.send(formData);
			// xhr.onload = function () {
			// 	if(xhr.status === 201) {
			// 		console.log("Post successfully created!") 
			// 	}
			// }
			let postObj = { 
				id: 1, 
				title: "What is AJAX", 
				body: "AJAX stands for Asynchronous JavaScript..."
			}
			let post = JSON.stringify(postObj)
			
			const url = "http://localhost:5000"
			let xhr = new XMLHttpRequest()
			
			xhr.open('POST', url, true)
			// xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
			xhr.send(formData);
			
			xhr.onload = function () {
				if(xhr.status === 200) {
					console.log("Post successfully created!") 
				}
			}
			// $http.post('http://localhost:5000', formData ,{transformRequest: angular.identity,headers: {'Content-Type': 'multipart/form-data'}}).then(function (response) {
			// 	console.log(response);
			// })
		}
	})


    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", "http://localhost:5000", false ); // false for synchronous request
    xmlHttp.send( null );
    data = JSON.parse(xmlHttp.responseText)
    let coordinates = data.features[0].geometry.coordinates
    
	
	// add event listener
	function upload() {
		const shp = document.querySelector('[name=shp]').files;
		const dbf = document.querySelector('[name=dbf]').files;
		const formData = new FormData();
		formData.append('shp', shp[0]);
		formData.append('dbf', dbf[0]);
		const url = "http://localhost:5000";
		fetch(url, {
			method: 'post', // Default is 'get'
			body: formData,
			// headers: new Headers({
			// 	'Content-Type': 'multipart/form-data'
			// })
		})
		.then(response => response.json())
		.then(json => {
			location.url = "/?1232"
		})	
	}
	// function upload() {
	// 	const url = "http://localhost:5000";
	// 	const shp = document.querySelector('[name=shp]').files;
	// 	const dbf = document.querySelector('[name=dbf]').files;
	// 	const formData = new FormData();
	// 	formData.append('shp', shp[0]);
	// 	formData.append('dbf', dbf[0]);

	// 	// post form data
	// 	const xhr = new XMLHttpRequest();

	// 	// log response
	// 	xhr.onload = () => {
	// 		console.log(xhr.responseText);
	// 		window.location.url = 'sdfs'
	// 	};
	// 	// xhr.onreadystatechange = function() {
	// 	// 	if (this.readyState == 4 && this.status == 200) {
	// 	// 		console.log(this.responseText);
	// 	// 	}
	// 	// };

	// 	// create and send the reqeust
	// 	xhr.open('POST', url);
	// 	xhr.send(formData);
	// }
	// form.addEventListener('submit', e => {

	// 	// disable default action
	// 	e.preventDefault();

	// 	// collect files
	// 	const shp = document.querySelector('[name=shp]').files;
	// 	const dbf = document.querySelector('[name=dbf]').files;
	// 	const formData = new FormData();
	// 	formData.append('shp', shp[0]);
	// 	formData.append('dbf', dbf[0]);

	// 	// post form data
	// 	const xhr = new XMLHttpRequest();

	// 	// log response
	// 	// xhr.onload = () => {
	// 	// 	console.log(xhr.responseText);
	// 	// 	window.location.url = 'sdfs'
	// 	// };
	// 	xhr.onreadystatechange = function() {
	// 		if (this.readyState == 4 && this.status == 200) {
	// 			console.log(this.responseText);
	// 		}
	// 	};

	// 	// create and send the reqeust
	// 	xhr.open('POST', url);
	// 	xhr.send(formData);
		
	// });
</script>
<script>
    reverse = data.bbox.reverse()

	var map = L.map('map').setView([reverse[0],reverse[1]], 9);

	var tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(map);

	// var marker = L.marker([51.5, -0.09]).addTo(map)
	// 	.bindPopup('<b>Hello world!</b><br />I am a popup.').openPopup();

	var polygon = L.polygon([coordinates]).addTo(map).bindPopup('I am a polygon.');

	function onMapClick(e) {
		popup
			.setLatLng(e.latlng)
			.setContent('You clicked the map at ' + e.latlng.toString())
			.openOn(map);
	}

	map.on('click', onMapClick);

</script>



</body>
</html>
